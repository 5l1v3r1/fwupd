From dfe649163cbd3689e2685a90e24ac14cfbe11612 Mon Sep 17 00:00:00 2001
From: Jussi Kukkonen <jussi.kukkonen@intel.com>
Date: Tue, 30 Jun 2015 19:38:46 +0300
Subject: [PATCH] build: gusb is required even without colorhug

Fix build failure when building with --disable-colorhug.
---
 configure.ac    | 3 ++-
 src/Makefile.am | 2 ++
 2 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/configure.ac b/configure.ac
index 946c80c..6bb1d15 100644
--- a/configure.ac
+++ b/configure.ac
@@ -120,6 +120,7 @@ PKG_CHECK_MODULES(GUDEV, gudev-1.0)
 PKG_CHECK_MODULES(POLKIT, polkit-gobject-1 >= 0.103)
 PKG_CHECK_MODULES(GCAB, libgcab-1.0)
 PKG_CHECK_MODULES(APPSTREAM_GLIB, appstream-glib >= 0.3.5)
+PKG_CHECK_MODULES(GUSB, gusb >= 0.2.2)
 PKG_CHECK_MODULES(SQLITE, sqlite3)
 AC_PATH_PROG(DOCBOOK2MAN, docbook2man)
 
@@ -127,7 +128,7 @@ AC_PATH_PROG(DOCBOOK2MAN, docbook2man)
 AC_ARG_ENABLE(colorhug, AS_HELP_STRING([--enable-colorhug],[Enable ColorHug support]),
 	      enable_colorhug=$enableval, enable_colorhug=yes)
 if test x$enable_colorhug != xno; then
-	PKG_CHECK_MODULES(COLORHUG, colorhug >= 1.2.9 gusb >= 0.2.2)
+	PKG_CHECK_MODULES(COLORHUG, colorhug >= 1.2.9)
 	AC_DEFINE(HAVE_COLORHUG,1,[Use ColorHug support])
 fi
 AM_CONDITIONAL(HAVE_COLORHUG, test x$enable_colorhug = xyes)
diff --git a/src/Makefile.am b/src/Makefile.am
index 72abf46..bcfeb08 100644
--- a/src/Makefile.am
+++ b/src/Makefile.am
@@ -5,6 +5,7 @@ dist_introspection_DATA = 				\
 AM_CPPFLAGS =						\
 	$(APPSTREAM_GLIB_CFLAGS)			\
 	$(COLORHUG_CFLAGS)				\
+	$(GUSB_CFLAGS)					\
 	$(GCAB_CFLAGS)					\
 	$(GLIB_CFLAGS)					\
 	$(GUDEV_CFLAGS)					\
@@ -110,6 +111,7 @@ fwupd_LDADD =						\
 	$(FWUPD_LIBS)					\
 	$(APPSTREAM_GLIB_LIBS)				\
 	$(COLORHUG_LIBS)				\
+	$(GUSB_LIBS)					\
 	$(GCAB_LIBS)					\
 	$(GLIB_LIBS)					\
 	$(GUDEV_LIBS)					\
-- 
1.9.1

