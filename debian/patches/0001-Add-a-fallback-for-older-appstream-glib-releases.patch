From 27aad5ac1fa4b19ff3bffaae97e8f634b5607134 Mon Sep 17 00:00:00 2001
From: Richard Hughes <richard@hughsie.com>
Date: Mon, 29 Aug 2016 16:12:23 +0100
Subject: [PATCH] Add a fallback for older appstream-glib releases

Fixes: https://github.com/hughsie/fwupd/issues/62
---
 src/fu-main.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/src/fu-main.c b/src/fu-main.c
index c785fa7..b8e01e8 100644
--- a/src/fu-main.c
+++ b/src/fu-main.c
@@ -1708,12 +1708,18 @@ fu_main_daemon_method_call (GDBusConnection *connection, const gchar *sender,
 		if (fwupd_result_get_unique_id (FWUPD_RESULT (item->device)) == NULL) {
 			g_autofree gchar *id2 = NULL;
 			FwupdResult *res = FWUPD_RESULT (item->device);
+#if AS_CHECK_VERSION(0,6,1)
 			id2 = as_utils_unique_id_build (AS_APP_SCOPE_SYSTEM,
 							AS_BUNDLE_KIND_UNKNOWN,
 							NULL,
 							AS_APP_KIND_FIRMWARE,
 							fwupd_result_get_device_name (res),
 							fwupd_result_get_device_version (res));
+#else
+			id2 = g_strdup_printf ("system/*/*/firmware/%s/%s",
+					       fwupd_result_get_device_name (res),
+					       fwupd_result_get_device_version (res));
+#endif
 			fwupd_result_set_unique_id (res, id2);
 		}
 
-- 
2.7.4

