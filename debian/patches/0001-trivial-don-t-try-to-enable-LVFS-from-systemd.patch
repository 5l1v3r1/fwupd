From 561751faff40f4f3fa367ed21200a6910a6992a3 Mon Sep 17 00:00:00 2001
From: Mario Limonciello <mario.limonciello@dell.com>
Date: Fri, 18 Oct 2019 08:51:52 -0500
Subject: [PATCH] trivial: don't try to enable LVFS from systemd

---
 data/motd/fwupd-refresh.service.in | 2 +-
 src/fu-util.c                      | 6 ++++++
 2 files changed, 7 insertions(+), 1 deletion(-)

diff --git a/data/motd/fwupd-refresh.service.in b/data/motd/fwupd-refresh.service.in
index d5ad37f..2264eb0 100644
--- a/data/motd/fwupd-refresh.service.in
+++ b/data/motd/fwupd-refresh.service.in
@@ -16,5 +16,5 @@ ProtectKernelModules=yes
 ProtectControlGroups=yes
 RestrictRealtime=yes
 SuccessExitStatus=2
-ExecStart=@bindir@/fwupdmgr refresh
+ExecStart=@bindir@/fwupdmgr refresh --no-metadata-check
 @dynamic_options@
diff --git a/src/fu-util.c b/src/fu-util.c
index aeed675..5337f26 100644
--- a/src/fu-util.c
+++ b/src/fu-util.c
@@ -1326,6 +1326,12 @@ fu_util_download_metadata (FuUtilPrivate *priv, GError **error)
 
 	/* no web remote is declared; try to enable LVFS */
 	if (!download_remote_enabled) {
+		/* we don't want to ask anything */
+		if (priv->no_metadata_check) {
+			g_debug ("skipping metadata check");
+			return TRUE;
+		}
+
 		if (!fu_util_download_metadata_enable_lvfs (priv, error))
 			return FALSE;
 	}
-- 
2.7.4

