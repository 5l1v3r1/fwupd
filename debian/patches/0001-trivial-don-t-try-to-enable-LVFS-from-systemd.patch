From 561751faff40f4f3fa367ed21200a6910a6992a3 Mon Sep 17 00:00:00 2001
From: Mario Limonciello <mario.limonciello@dell.com>
Date: Fri, 18 Oct 2019 08:51:52 -0500
Subject: [PATCH] trivial: don't try to enable LVFS from systemd

---
 data/motd/fwupd-refresh.service.in | 2 +-
 src/fu-util.c                      | 6 ++++++
 2 files changed, 7 insertions(+), 1 deletion(-)

Index: fwupd/data/motd/fwupd-refresh.service.in
===================================================================
--- fwupd.orig/data/motd/fwupd-refresh.service.in
+++ fwupd/data/motd/fwupd-refresh.service.in
@@ -16,5 +16,5 @@ ProtectKernelModules=yes
 ProtectControlGroups=yes
 RestrictRealtime=yes
 SuccessExitStatus=2
-ExecStart=@bindir@/fwupdmgr refresh
+ExecStart=@bindir@/fwupdmgr refresh --no-metadata-check
 @dynamic_options@
Index: fwupd/src/fu-util.c
===================================================================
--- fwupd.orig/src/fu-util.c
+++ fwupd/src/fu-util.c
@@ -1231,6 +1231,12 @@ fu_util_download_metadata (FuUtilPrivate
 
 	/* no web remote is declared; try to enable LVFS */
 	if (!download_remote_enabled) {
+		/* we don't want to ask anything */
+		if (priv->no_metadata_check) {
+			g_debug ("skipping metadata check");
+			return TRUE;
+		}
+
 		if (!fu_util_download_metadata_enable_lvfs (priv, error))
 			return FALSE;
 	}
